{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "mermaid_to_pdf Output with Caching",
  "description": "Extended output schema for mermaid_to_pdf when caching is enabled",

  "output": {
    "oneOf": [
      {
        "title": "Success with Artifact Reference (cached mode)",
        "type": "object",
        "required": [
          "ok",
          "request_id",
          "artifact",
          "mode",
          "warnings",
          "errors"
        ],
        "properties": {
          "ok": { "type": "boolean", "const": true },
          "request_id": { "type": "string", "format": "uuid" },
          "artifact": { "$ref": "./artifact-reference.json" },
          "mode": { "type": "string", "const": "cached" },
          "warnings": {
            "type": "array",
            "items": { "$ref": "#/definitions/warning" }
          },
          "errors": { "type": "array", "maxItems": 0 }
        },
        "additionalProperties": false
      },
      {
        "title": "Success with Inline Content (fallback mode)",
        "type": "object",
        "required": [
          "ok",
          "request_id",
          "pdf_base64",
          "mode",
          "warnings",
          "errors"
        ],
        "properties": {
          "ok": { "type": "boolean", "const": true },
          "request_id": { "type": "string", "format": "uuid" },
          "pdf_base64": {
            "type": "string",
            "description": "Base64-encoded PDF content"
          },
          "mode": { "type": "string", "const": "inline" },
          "warnings": {
            "type": "array",
            "items": { "$ref": "#/definitions/warning" }
          },
          "errors": { "type": "array", "maxItems": 0 }
        },
        "additionalProperties": false
      },
      {
        "title": "Error Response",
        "type": "object",
        "required": ["ok", "request_id", "warnings", "errors"],
        "properties": {
          "ok": { "type": "boolean", "const": false },
          "request_id": { "type": "string", "format": "uuid" },
          "warnings": { "type": "array" },
          "errors": {
            "type": "array",
            "minItems": 1,
            "items": { "$ref": "#/definitions/error" }
          }
        },
        "additionalProperties": false
      }
    ]
  },

  "definitions": {
    "warning": {
      "type": "object",
      "required": ["code", "message"],
      "properties": {
        "code": {
          "type": "string",
          "enum": ["CACHE_UNAVAILABLE", "CACHE_WRITE_FAILED", "QUOTA_EXCEEDED"]
        },
        "message": { "type": "string" }
      }
    },
    "error": {
      "type": "object",
      "required": ["code", "message"],
      "properties": {
        "code": {
          "type": "string",
          "enum": [
            "INVALID_INPUT",
            "INPUT_TOO_LARGE",
            "INVALID_TIMEOUT",
            "INVALID_CONFIG",
            "PARSE_ERROR",
            "RENDER_FAILED",
            "RENDER_TIMEOUT"
          ]
        },
        "message": { "type": "string" },
        "details": { "type": "object" }
      }
    }
  },

  "examples": {
    "success_cached": {
      "description": "Successful render with artifact reference",
      "output": {
        "ok": true,
        "request_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
        "artifact": {
          "artifact_id": "6ba7b810-9dad-11d1-80b4-00c04fd430c8",
          "uri": "file:///tmp/mermaid-mcp-cache/session123/6ba7b810-9dad-11d1-80b4-00c04fd430c8.pdf",
          "content_type": "application/pdf",
          "size_bytes": 98765
        },
        "mode": "cached",
        "warnings": [],
        "errors": []
      }
    },
    "success_inline_fallback": {
      "description": "Successful render with inline content (cache unavailable)",
      "output": {
        "ok": true,
        "request_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
        "pdf_base64": "JVBERi0xLjQK...",
        "mode": "inline",
        "warnings": [
          {
            "code": "CACHE_UNAVAILABLE",
            "message": "Caching unavailable, returning inline content"
          }
        ],
        "errors": []
      }
    }
  }
}
