{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "mermaid_to_svg Output with Caching",
  "description": "Extended output schema for mermaid_to_svg when caching is enabled",

  "output": {
    "oneOf": [
      {
        "title": "Success with Artifact Reference (cached mode)",
        "type": "object",
        "required": [
          "ok",
          "request_id",
          "artifact",
          "mode",
          "warnings",
          "errors"
        ],
        "properties": {
          "ok": { "type": "boolean", "const": true },
          "request_id": { "type": "string", "format": "uuid" },
          "artifact": { "$ref": "./artifact-reference.json" },
          "mode": { "type": "string", "const": "cached" },
          "warnings": {
            "type": "array",
            "items": { "$ref": "#/definitions/warning" }
          },
          "errors": { "type": "array", "maxItems": 0 }
        },
        "additionalProperties": false
      },
      {
        "title": "Success with Inline Content (fallback mode)",
        "type": "object",
        "required": ["ok", "request_id", "svg", "mode", "warnings", "errors"],
        "properties": {
          "ok": { "type": "boolean", "const": true },
          "request_id": { "type": "string", "format": "uuid" },
          "svg": { "type": "string", "description": "SVG content as string" },
          "mode": { "type": "string", "const": "inline" },
          "warnings": {
            "type": "array",
            "items": { "$ref": "#/definitions/warning" }
          },
          "errors": { "type": "array", "maxItems": 0 }
        },
        "additionalProperties": false
      },
      {
        "title": "Error Response",
        "type": "object",
        "required": ["ok", "request_id", "warnings", "errors"],
        "properties": {
          "ok": { "type": "boolean", "const": false },
          "request_id": { "type": "string", "format": "uuid" },
          "warnings": { "type": "array" },
          "errors": {
            "type": "array",
            "minItems": 1,
            "items": { "$ref": "#/definitions/error" }
          }
        },
        "additionalProperties": false
      }
    ]
  },

  "definitions": {
    "warning": {
      "type": "object",
      "required": ["code", "message"],
      "properties": {
        "code": {
          "type": "string",
          "enum": ["CACHE_UNAVAILABLE", "CACHE_WRITE_FAILED", "QUOTA_EXCEEDED"]
        },
        "message": { "type": "string" }
      }
    },
    "error": {
      "type": "object",
      "required": ["code", "message"],
      "properties": {
        "code": {
          "type": "string",
          "enum": [
            "INVALID_INPUT",
            "INPUT_TOO_LARGE",
            "INVALID_TIMEOUT",
            "INVALID_CONFIG",
            "PARSE_ERROR",
            "RENDER_FAILED",
            "RENDER_TIMEOUT"
          ]
        },
        "message": { "type": "string" },
        "details": { "type": "object" }
      }
    }
  },

  "examples": {
    "success_cached": {
      "description": "Successful render with artifact reference",
      "output": {
        "ok": true,
        "request_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
        "artifact": {
          "artifact_id": "550e8400-e29b-41d4-a716-446655440000",
          "uri": "file:///tmp/mermaid-mcp-cache/session123/550e8400-e29b-41d4-a716-446655440000.svg",
          "content_type": "image/svg+xml",
          "size_bytes": 12345
        },
        "mode": "cached",
        "warnings": [],
        "errors": []
      }
    },
    "success_inline_fallback": {
      "description": "Successful render with inline content (cache unavailable)",
      "output": {
        "ok": true,
        "request_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
        "svg": "<svg xmlns=\"http://www.w3.org/2000/svg\">...</svg>",
        "mode": "inline",
        "warnings": [
          {
            "code": "CACHE_UNAVAILABLE",
            "message": "Caching unavailable, returning inline content"
          }
        ],
        "errors": []
      }
    }
  }
}
